@component-name = "portal-content-dashboard"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Content Dashboard";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		JSONGroup.addGroup(groupName = "Test Site Name");

		Navigator.openURL();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
	}

	@description = "When the user clicks on the Flip axes button, the vocabularies will be exchanged, the vocabulary represented in the X (the first in the list in the "In use" box) is sent to the Y, and the other way around"
	@priority = "5"
	test AuditGraphFlipAxes {
		property portal.acceptance = "true";

		JSONCategory.addCategory(
			groupName = "Global",
			title = "Audience 1",
			vocabularyName = "Audience");

		JSONCategory.addCategory(
			groupName = "Global",
			title = "Stage 1",
			vocabularyName = "Stage");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContentNavigator.gotoAddCP();

		WebContent.addWithCategoryCP(
			categoryName = "Audience 1",
			vocabularyName = "Audience",
			webContentContent = "Web Content Content",
			webContentTitle = "WC Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContentNavigator.gotoEditCP(webContentTitle = "WC Title");

		WebContent.selectCategory(
			categoryName = "Stage 1",
			userSegmentDetailTitle = "${userSegmentDetailTitle}",
			vocabularyName = "Stage");

		PortletEntry.publish();

		ApplicationsMenu.gotoPortlet(
			category = "Content",
			panel = "Applications",
			portlet = "Content Dashboard");

		Pause(locator1 = "3000");

		AssertTextPresent(
			locator1 = "ContentDashboard#X_AXIS_VOCABULARY_NAME",
			value1 = "WC Title",
			xAxisCtegoryName = "Stage 1");

		ContentDashboard.flipAxesButtonClick();

		AssertTextPresent(
			locator1 = "ContentDashboard#X_AXIS_VOCABULARY_NAME",
			value1 = "WC Title",
			xAxisCtegoryName = "Audience 1");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContent.viewTitle(webContentTitle = "WC Title");

		WebContent.deleteCP(
			siteURLKey = "test-site-name",
			webContentTitle = "WC Title");

		Category.openCategoriesAdmin(siteURLKey = "global");

		Category.deleteCategoriesCP(vocabularyName = "Audience");

		Category.openCategoriesAdmin(siteURLKey = "global");

		Category.deleteCategoriesCP(vocabularyName = "Stage");
	}

	@description = "When there are not contents with Audience's categories, the X axis will show just one bar per each one of Stage's categories representing the total number of contents labeled with those categories"
	@priority = "5"
	test AuditGraphNoContentsForAudience {
		property portal.acceptance = "true";

		var categoryId = JSONCategory.addCategory(
			groupName = "Global",
			title = "Stage 1",
			vocabularyName = "Stage");

		JSONWebcontent.addWebContent(
			assetCategoryIds = "${categoryId}",
			content = "WC content",
			groupName = "Test Site Name",
			title = "WC Title");

		ApplicationsMenu.gotoPortlet(
			category = "Content",
			panel = "Applications",
			portlet = "Content Dashboard");

		AssertTextPresent(
			locator1 = "ContentDashboard#X_AXIS_VOCABULARY_NAME",
			value1 = "WC Title",
			xAxisCtegoryName = "Stage 1");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContent.viewTitle(webContentTitle = "WC Title");

		WebContent.deleteCP(
			siteURLKey = "test-site-name",
			webContentTitle = "WC Title");

		Category.openCategoriesAdmin(siteURLKey = "global");

		Category.deleteCategoriesCP(vocabularyName = "Stage");
	}

	@description = "When there are not contents with Stage's categories, the X axis will show just one bar per each one of Audience's categories representing the total number of contents labeled with those categories"
	@priority = "5"
	test AuditGraphNoContentsForStage {
		property portal.acceptance = "true";

		var categoryId = JSONCategory.addCategory(
			groupName = "Global",
			title = "Audience 1",
			vocabularyName = "Audience");

		JSONWebcontent.addWebContent(
			assetCategoryIds = "${categoryId}",
			content = "WC content",
			groupName = "Test Site Name",
			title = "WC Title");

		ApplicationsMenu.gotoPortlet(
			category = "Content",
			panel = "Applications",
			portlet = "Content Dashboard");

		AssertTextPresent(
			locator1 = "ContentDashboard#X_AXIS_VOCABULARY_NAME",
			value1 = "WC Title",
			xAxisCtegoryName = "Audience 1");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContent.viewTitle(webContentTitle = "WC Title");

		WebContent.deleteCP(
			siteURLKey = "test-site-name",
			webContentTitle = "WC Title");

		Category.openCategoriesAdmin(siteURLKey = "global");

		Category.deleteCategoriesCP(vocabularyName = "Audience");
	}

	@description = "When the user unchecks all of the checkboxes of the content audit graph, all bars in the graph disappear and a message is shown: No Stage Categories selected. Select any stage category from the checkboxes in the legend above."
	@priority = "5"
	test AuditGraphUncheckCheckbox {
		property portal.acceptance = "true";

		JSONCategory.addCategory(
			groupName = "Global",
			title = "Audience 1",
			vocabularyName = "Audience");

		JSONCategory.addCategory(
			groupName = "Global",
			title = "Stage 1",
			vocabularyName = "Stage");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContentNavigator.gotoAddCP();

		WebContent.addWithCategoryCP(
			categoryName = "Audience 1",
			vocabularyName = "Audience",
			webContentContent = "Web Content Content",
			webContentTitle = "WC Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContentNavigator.gotoEditCP(webContentTitle = "WC Title");

		WebContent.selectCategory(
			categoryName = "Stage 1",
			userSegmentDetailTitle = "${userSegmentDetailTitle}",
			vocabularyName = "Stage");

		PortletEntry.publish();

		ApplicationsMenu.gotoPortlet(
			category = "Content",
			panel = "Applications",
			portlet = "Content Dashboard");

		Pause(locator1 = "3000");

		ContentDashboard.uncheckCheckbox(checkboxName = "Stage 1");

		AssertTextPresent(
			locator1 = "ContentDashboard#NO_CATEGORIES_SELECTED_TEXT",
			value1 = "There are no categories selected");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "test-site-name");

		WebContent.viewTitle(webContentTitle = "WC Title");

		WebContent.deleteCP(
			siteURLKey = "test-site-name",
			webContentTitle = "WC Title");

		Category.openCategoriesAdmin(siteURLKey = "global");

		Category.deleteCategoriesCP(vocabularyName = "Audience");

		Category.openCategoriesAdmin(siteURLKey = "global");

		Category.deleteCategoriesCP(vocabularyName = "Stage");
	}

}