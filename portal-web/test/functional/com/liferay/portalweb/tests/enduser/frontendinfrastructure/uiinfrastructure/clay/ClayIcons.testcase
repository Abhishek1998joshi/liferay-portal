@component-name = "portal-frontend-infrastructure"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.component.names = "Clay";
	property testray.main.component.name = "User Interface";

    setUp {
        TestCase.setUpPortalInstance();

        User.firstLoginPG();

        task ("Add a site") {
                JSONGroup.addGroup(groupName = "Test Site Name");
            }

        task ("Add a widget page") {
                JSONLayout.addPublicLayout(
                    groupName = "Test Site Name",
                    layoutName = "Language Test Page Name");
            }

        task ("Add a Language Selector to page") {
                JSONLayout.addWidgetToPublicLayout(
                    groupName = "Test Site Name",
                    layoutName = "Language Test Page Name",
                    widgetName = "Language Selector");
            }
        }

        tearDown {
            var testPortalInstance = PropsUtil.get("test.portal.instance");

            if ("${testPortalInstance}" == "true") {
                PortalInstances.tearDownCP();
            }
            else {
                JSONGroup.deleteGroupByName(groupName = "Test Site Name");
            }
        }

	@description = "LPS-152271 Verify that flag icons are present when clicking on localization button"
	@priority = "5"
	test FlagIconsCanRender {
        task ("Given language portlet") {
            Navigator.gotoSitePage(
				pageName = "Language Test Page Name",
				siteName = "Test Site Name");

           AssertElementPresent(
                locator1 = "Icon#FLAG_enUS");

            LanguagePortlet.viewCurrentLanguage(locale = "en-US");         
        }  
   
        task ("When click on localization button") {
            Click(
                locator1 = "Icon#FLAG_enUS");
        }

        task ("Then flag icons are present on the button and dropdown menu items") {
            if (IsElementPresent(locator1 = "Icon#FLAG_caES")) {
                AssertTextEquals(
                    key_text = "catala_2d_espanya",
                    locator1 = "Language#ANY");
            }
        }  
    }
}