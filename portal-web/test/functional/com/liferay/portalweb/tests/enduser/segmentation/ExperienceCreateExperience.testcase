@component-name = "portal-segmentation"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Segmentation";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		Navigator.openURL();

		ApplicationsMenu.gotoPortlet(
			category = "Configuration",
			panel = "Control Panel",
			portlet = "Instance Settings");

		SystemSettings.gotoConfiguration(
			configurationCategory = "User Authentication",
			configurationName = "General",
			configurationScope = "Virtual Instance Scope");

		PortalSettings.uncheckStrangersVerifyEmailCheckbox();

		// Create site and content page

		JSONGroup.addGroup(groupName = "Test Site Name");

		SitePages.openPagesAdmin(siteURLKey = "test-site-name");

		ContentPages.addPage(pageName = "Experience Content Page");

		// Create segmentation

		ProductMenu.gotoPortlet(
			category = "People",
			portlet = "Segments");

		LexiconEntry.gotoAdd();

		Segmentation.addProperties(propertyOption = "Email Address");

		Segmentation.fillTitle(titleField = "AddSegmentUserEmailAddressContains Test");

		Segmentation.changeCriterionInputEmailAddress(criterionInputOption = "Contains");

		Segmentation.fillProperty(PropertyField = "liferay");

		Button.clickSave();

		Alert.viewSuccessMessage();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			Site.tearDownCP();
		}
	}

	@description = "When the user creates a new experience, it is always placed in the last position of the list, always below the default experience and always set as non-active"
	@priority = "5"
	test AddNewAnyoneExperience {
		property portal.acceptance = "true";

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addFragment(
			collectionName = "Basic Components",
			fragmentName = "Heading");

		PageEditor.editFragmentText(
			fragmentName = "Heading",
			id = "element-text",
			text = "Default");

		Button.clickPublish();

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addExperience(
			experienceName = "NewAnyoneExperience",
			segmentName = "Anyone");

		Refresh();

		PageEditor.changeExperience(newExperience = "NewAnyoneExperience");

		PageEditor.editFragmentText(
			fragmentName = "Heading",
			id = "element-text",
			text = "Anyone1");

		Button.clickPublish();

		User.logoutPG();

		Navigator.gotoSitePage(
			pageName = "Experience Content Page",
			siteName = "Test Site Name");

		AssertTextEquals(
			locator1 = "Experience#FRAGMENT_HEADING",
			value1 = "Default");

		User.firstLoginPG();
	}

	@description = "The Add new experience modals appears after click on cancel in the Edit experience modal"
	@priority = "5"
	test AddNewExperienceAfterCancelEdit {
		property portal.acceptance = "true";

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addExperience(
			experienceName = "NewExp1",
			segmentName = "Anyone");

		Refresh();

		Click(locator1 = "PageEditor#EXPERIENCE_DEFAULT_BUTTON_NAME");

		Click(locator1 = "PageEditor#EXPERIENCE_EDIT_BUTTON");

		AssertClick(
			locator1 = "Button#CANCEL",
			value1 = "Cancel");

		Click(locator1 = "PageEditor#EXPERIENCE_DEFAULT_BUTTON_NAME");

		Click(
			key_text = "New Experience",
			locator1 = "Button#ANY");

		SelectFrame(value1 = "relative=top");

		AssertTextEquals(
			locator1 = "PageEditor#EXPERIENCE_NEW_EXPERIENCE_MODAL_TITLE",
			value1 = "New Experience");

		AssertTextEquals(
			locator1 = "PageEditor#EXPERIENCE_NAME",
			value1 = "");

		AssertClick(
			locator1 = "Button#CANCEL",
			value1 = "Cancel");

		PageEditor.clickPublish();
	}

	@description = "This is a test for LPS-130309."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationCountrySegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130309 AddNewExperienceOrganizationCountrySegment pending implementation
	}

	@description = "This is a test for LPS-130302."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationDateModifiedSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130302 AddNewExperienceOrganizationDateModifiedSegment pending implementation
	}

	@description = "This is a test for LPS-130303."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationHierarchyPathSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130303 AddNewExperienceOrganizationHierarchyPathSegment pending implementation
	}

	@description = "This is a test for LPS-130304."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationNameSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130304 AddNewExperienceOrganizationNameSegment pending implementation
	}

	@description = "This is a test for LPS-130306."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationOrganizationSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130306 AddNewExperienceOrganizationOrganizationSegment pending implementation
	}

	@description = "This is a test for LPS-130307."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationParentOrganizationSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130307 AddNewExperienceOrganizationParentOrganizationSegment pending implementation
	}

	@description = "This is a test for LPS-130310."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationRegionSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130310 AddNewExperienceOrganizationRegionSegment pending implementation
	}

	@description = "This is a test for LPS-130311."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationTagSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130311 AddNewExperienceOrganizationTagSegment pending implementation
	}

	@description = "This is a test for LPS-130308."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceOrganizationTypeSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130308 AddNewExperienceOrganizationTypeSegment pending implementation
	}

	@description = "This is a test for LPS-130327."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionBrowserSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130327 AddNewExperienceSessionBrowserSegment pending implementation
	}

	@description = "This is a test for LPS-130328."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionCookiesSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130328 AddNewExperienceSessionCookiesSegment pending implementation
	}

	@description = "This is a test for LPS-130329."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionDeviceBrandSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130329 AddNewExperienceSessionDeviceBrandSegment pending implementation
	}

	@description = "This is a test for LPS-130330."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionDeviceModelSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130330 AddNewExperienceSessionDeviceModelSegment pending implementation
	}

	@description = "This is a test for LPS-130331."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionDeviceScreenResolutionHeightSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130331 AddNewExperienceSessionDeviceScreenResolutionHeightSegment pending implementation
	}

	@description = "This is a test for LPS-130332."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionDeviceScreenResolutionWidthSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130332 AddNewExperienceSessionDeviceScreenResolutionWidthSegment pending implementation
	}

	@description = "This is a test for LPS-130333."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionHostnameSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130333 AddNewExperienceSessionHostnameSegment pending implementation
	}

	@description = "This is a test for LPS-130334."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionLanguageSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130334 AddNewExperienceSessionLanguageSegment pending implementation
	}

	@description = "This is a test for LPS-130335."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionLastSignInDateSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130335 AddNewExperienceSessionLastSignInDateSegment pending implementation
	}

	@description = "This is a test for LPS-130336."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionLocalDateSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130336 AddNewExperienceSessionLocalDateSegment pending implementation
	}

	@description = "This is a test for LPS-130337."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionReferrerURLSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130337 AddNewExperienceSessionReferrerURLSegment pending implementation
	}

	@description = "This is a test for LPS-130338."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionRequestParametersSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130338 AddNewExperienceSessionRequestParametersSegment pending implementation
	}

	@description = "This is a test for LPS-130339."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionSignedInSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130339 AddNewExperienceSessionSignedInSegment pending implementation
	}

	@description = "This is a test for LPS-130340."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionURLSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130340 AddNewExperienceSessionURLSegment pending implementation
	}

	@description = "This is a test for LPS-130341."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceSessionUserAgentSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130341 AddNewExperienceSessionUserAgentSegment pending implementation
	}

	@description = "This is a test for LPS-130293."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserDateModifiedSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130293 AddNewExperienceUserDateModifiedSegment pending implementation
	}

	@description = "This is a test for LPS-130294."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserDateOfBirthSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130294 AddNewExperienceUserDateOfBirthSegment pending implementation
	}

	@description = "This is a test for LPS-130301."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserEmailAddressSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130301 AddNewExperienceUserEmailAddressSegment pending implementation
	}
	
	@description = "This is a test for LPS-130295."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserFirstNameSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130295 AddNewExperienceUserFirstNameSegment pending implementation
	}

	@description = "This is a test for LPS-130296."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserJobTitleSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130296 AddNewExperienceUserJobTitleSegment pending implementation
	}

	@description = "This is a test for LPS-130297."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserLastNameSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130297 AddNewExperienceUserLastNameSegment pending implementation
	}

	@description = "This is a test for LPS-130298."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserNameSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130298 AddNewExperienceUserNameSegment pending implementation
	}

	@description = "This is a test for LPS-130299."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserRoleSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130299 AddNewExperienceUserRoleSegment pending implementation
	}

	@description = "This is a test for LPS-130300."
	@ignore = "true"
	@priority = "5"
	test AddNewExperienceUserScreenNameSegment {
  		property portal.acceptance = "false";

  		// TODO LPS-130300 AddNewExperienceUserScreenNameSegment pending implementation
	}

	@description = "When the user opens the experiences selection modal and select a different locale for an experience, the experience version for that language is shown"
	@priority = "5"
	test AddNewExperienceWithLanguage {
		property portal.acceptance = "true";

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addFragment(
			collectionName = "Basic Components",
			fragmentName = "Heading");

		PageEditor.editFragmentText(
			fragmentName = "Heading",
			id = "element-text",
			text = "Text in english");

		Button.clickPublish();

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addExperienceWithLanguage(
			experienceName = "NewAnyoneExperience",
			language = "Spanish",
			segmentName = "Anyone");

		Refresh();

		PageEditor.changeExperienceLanguage(
			language = "es-ES",
			newExperience = "NewAnyoneExperience");

		PageEditor.editFragmentText(
			fragmentName = "Heading",
			id = "element-text",
			text = "Texto en español");

		Button.clickPublish();

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.changeExperience(newExperience = "NewAnyoneExperience");

		PageEditor.prioritizeExperience(experienceName = "NewAnyoneExperience");

		Button.clickPublish();

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		ApplicationsMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.editPasswordCP(
			requirePasswordReset = "true",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn");

		ApplicationsMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.editDisplaySettingsCP(
			languageName = "español (España)",
			userScreenName = "usersn");

		User.logoutPG();

		Navigator.gotoSitePage(
			pageName = "Experience Content Page",
			siteName = "Test Site Name");

		AssertTextEquals(
			locator1 = "Experience#FRAGMENT_HEADING",
			value1 = "Text in english");

		User.loginUserPG(
			password = "test",
			userEmailAddress = "userea@liferay.com");

		Navigator.gotoSitePage(
			pageName = "Experience Content Page",
			siteName = "Test Site Name");

		AssertTextEquals(
			locator1 = "Experience#FRAGMENT_HEADING",
			value1 = "Texto en español");

		User.firstLoginPG();
	}

	@description = "When the user clicks on the Duplicate option of an experience, a new experience with [the same name] + Copy and the same audience (Segment) appears in the last position of the list, always below the default experience"
	@priority = "5"
	test DuplicateExperience {
		property portal.acceptance = "true";

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addExperience(
			experienceName = "NewExp1",
			segmentName = "AddSegmentUserEmailAddressContains Test");

		Refresh();

		PageEditor.changeExperience(newExperience = "NewExp1");

		PageEditor.duplicateExperience(experienceName = "NewExp1");

		PageEditor.clickPublish();
	}

	@description = "When the user duplicates an experience, the new experience has the same locales selected than the duplicated one"
	@priority = "5"
	test DuplicateExperienceWithLanguage {
		property portal.acceptance = "true";

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addFragment(
			collectionName = "Basic Components",
			fragmentName = "Heading");

		PageEditor.editFragmentText(
			fragmentName = "Heading",
			id = "element-text",
			text = "Text in english");

		Button.clickPublish();

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addExperienceWithLanguage(
			experienceName = "NewAnyoneExperience",
			language = "Spanish",
			segmentName = "Anyone");

		Refresh();

		PageEditor.changeExperienceLanguage(
			language = "es-ES",
			newExperience = "NewAnyoneExperience");

		PageEditor.editFragmentText(
			fragmentName = "Heading",
			id = "element-text",
			text = "Texto en español");

		Button.clickPublish();

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.changeExperience(newExperience = "NewAnyoneExperience");

		PageEditor.duplicateExperience(experienceName = "NewAnyoneExperience");

		PageEditor.clickPublish();

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.changeExperienceLanguage(
			language = "es-ES",
			newExperience = "NewAnyoneExperience (Copy)");

		AssertTextEquals(
			locator1 = "Experience#FRAGMENT_HEADING",
			value1 = "Texto en español");

		PageEditor.clickPublish();
	}

	@description = "Validate experience edition and deletion"
	@priority = "5"
	test EditAndDeleteExperience {
		property portal.acceptance = "true";

		Navigator.openWithAppendToBaseURL(urlAppend = "web/test-site-name/experience-content-page");

		ContentPages.clickPencil();

		PageEditor.addExperience(
			experienceName = "exp1",
			segmentName = "AddSegmentUserEmailAddressContains Test");

		Refresh();

		PageEditor.editExperience(newExperience = "exp1_edited");

		PageEditor.deleteExperience(experienceName = "exp1_edited");

		PageEditor.clickPublish();
	}

}