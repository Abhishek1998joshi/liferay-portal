@component-name = "portal-collaboration"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Blogs";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			BlogsEntry.tearDownCP();
		}
	}

	@description = "This checks that the cover image of a blog entry can be changed."
	@priority = "4"
	@refactordone
	test CanChangeCoverImage {
		var imageId	= JSONBlog.uploadBlogImage(
			groupName = "Guest",
			sourceFileName = "Document_1.jpg");

		JSONBlog.addEntryWithImage(
			coverImageId = "${imageId}",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			groupName = "Guest");

		BlogsNavigator.openBlogsAdmin(siteURLKey = "guest");

		BlogsNavigator.gotoEntryCP(entryTitle = "Blogs Entry Title");

		BlogsEntry.viewEntryCP(
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			uploadFileName = "Document_1");

		BlogsEntry.editCoverImage(
			coverImageName = "Document_2.jpg",
			navTab = "Documents and Media",
			uploadFileName = "Document_2.jpg");

		PortletEntry.publish();

		BlogsNavigator.gotoEntryCP(entryTitle = "Blogs Entry Title");

		BlogsEntry.viewEntryCP(
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			uploadFileName = "Document_2");
	}

	@description = "This ensures that the cover image can be removed from the blog entry."
	@priority = "4"
	@refactordone
	test CanRemoveCoverImage {
		var imageId	= JSONBlog.uploadBlogImage(
			groupName = "Guest",
			sourceFileName = "Document_1.jpg");

		JSONBlog.addEntryWithImage(
			coverImageId = "${imageId}",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			groupName = "Guest");

		BlogsNavigator.openToEditEntryInSite(
			entryTitle = "Blogs Entry Title",
			groupName = "Guest",
			siteURLKey = "guest");

		BlogsEntry.removeCoverImage(coverImageName = "Document_1.jpg");

		PortletEntry.publish();

		BlogsNavigator.openToEditEntryInSite(
			entryTitle = "Blogs Entry Title",
			groupName = "Guest",
			siteURLKey = "guest");

		AssertElementNotPresent(
			key_coverImageName = "Document_1.jpg",
			locator1 = "BlogsEntry#ENTRY_COVER_IMAGE_UNPUBLISHED");

		Navigator.gotoPage(pageName = "Blogs Page");

		AssertElementNotPresent(
			key_uploadFileName = "Document_1.jpg",
			locator1 = "BlogsEntry#ENTRY_COVER_IMAGE");
	}

	@description = "This is a usecase for LPS-83229. This is the only small image test for blogs."
	@priority = "5"
	@refactordone
	test CanRemoveSmallImage {
		property portal.acceptance = "true";
		property testray.component.names = "WYSIWYG";

		BlogsNavigator.openToAddEntry(
			layoutName = "Blogs Page",
			siteURLKey = "guest");

		BlogsEntry.addEntryContent(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry with Small Image");

		BlogsEntry.addSmallImage(
			navTab = "Documents and Media",
			uploadFileName = "Document_1.jpg");

		PortletEntry.publish();

		BlogsNavigator.openToEditEntryInSite(
			entryTitle = "Blogs Entry with Small Image",
			groupName = "Guest",
			siteURLKey = "guest");

		BlogsEntry.removeSmallImage(uploadFileName = "Document_1.jpg");

		PortletEntry.publish();

		BlogsNavigator.openToEditEntryInSite(
			entryTitle = "Blogs Entry with Small Image",
			groupName = "Guest",
			siteURLKey = "guest");

		AssertElementNotPresent(
			key_smallImage = "Document_1.jpg",
			locator1 = "BlogsEntry#SMALL_IMAGE");

		AssertTextEquals(
			locator1 = "Button#SELECT_FILE_SMALL_IMAGE",
			value1 = "Select File");
	}

	@description = "This ensures that the small image can be replaced."
	@priority = "4"
	@refactorneeded
	test CanReplaceSmallImage {
		BlogsNavigator.openToAddEntry(
			layoutName = "Blogs Page",
			siteURLKey = "guest");

		BlogsEntry.addEntryContent(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title");

		BlogsEntry.addSmallImage(
			navTab = "Documents and Media",
			uploadFileName = "Document_1.jpg");

		PortletEntry.publish();

		BlogsNavigator.openToEditEntryInSite(
			entryTitle = "Blogs Entry Title",
			groupName = "Guest",
			siteURLKey = "guest");

		BlogsEntry.addSmallImage(
			browseImage = "true",
			navTab = "Documents and Media",
			uploadFileName = "Document_2.jpg");

		PortletEntry.publish();

		Navigator.gotoPage(pageName = "Blogs Page");

		AssertVisible(
			key_imageFileName = "Document_2.jpg",
			locator1 = "BlogsEntry#CONTENT_SMALL_IMAGE",
			value1 = "Document_2.jpg");
	}

	@description = "This checks that a cover image can be saved as a draft."
	@priority = "3"
	@refactordone
	test CanSaveCoverImageAsDraft {
		BlogsNavigator.openBlogsAdmin(siteURLKey = "guest");

		Blogs.addEntryWithUploadedCoverImage(
			coverImageName = "Document_1",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			navTab = "Blog Images",
			uploadFileName = "Document_1.jpg");

		BlogsEntry.saveAsDraft();

		Click(locator1 = "Icon#BACK");

		LexiconEntry.changeDisplayStyle(displayStyle = "list");

		Blogs.viewEntryTitle(entryTitle = "Blogs Entry Title");

		AssertTextEquals(
			key_entryTitle = "Blogs Entry Title",
			locator1 = "Blogs#DESCRIPTIVE_VIEW_ENTRY_STATUS",
			value1 = "Draft");

		BlogsNavigator.gotoEntryCP(entryTitle = "Blogs Entry Title");

		BlogsEntry.viewEntryCP(
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			uploadFileName = "Document_1");
	}

	@description = "This checks that a cover image can be uploaded and published in a blog"
	@priority = "3"
	@refactordone
	@uitest
	test CanUploadAndPublishCoverImage {
		Blogs.addEntryWithUploadedCoverImage(
			coverImageName = "Document_1",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			navTab = "Blog Images",
			uploadFileName = "Document_1.jpg");

		Button.clickPublish();

		BlogsNavigator.openToBlogEntry(
			entryTitle = "Blogs Entry Title",
			layoutName = "Blogs Page",
			siteURLKey = "guest");

		BlogsEntry.viewEntryPG(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title",
			uploadFileName = "Document_1.jpg");
	}

	@description = "This test covers LPS-111741. It ensures that a blog entry can be added with the same blog image."
	@priority = "4"
	@refactordone
	test CanUseBlogImageForDifferentEntries {
		var imageId	= JSONBlog.uploadBlogImage(
			groupName = "Guest",
			sourceFileName = "Document_1.jpg");

		JSONBlog.addEntryWithImage(
			coverImageId = "${imageId}",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			groupName = "Guest");

		BlogsNavigator.openBlogsAdmin(siteURLKey = "guest");

		Blogs.addEntryWithUploadedCoverImage(
			coverImageName = "Document_1",
			entryContent = "Blogs Entry Content new",
			entrySubtitle = "Blogs Entry Subtitle new",
			entryTitle = "Blogs Entry Title new",
			navTab = "Blog Images",
			uploadedFileName = "Document_1.jpg");

		Button.clickPublish();

		BlogsNavigator.gotoEntryCP(entryTitle = "Blogs Entry Title new");

		BlogsEntry.viewEntryCP(
			entryContent = "Blogs Entry Content new",
			entrySubtitle = "Blogs Entry Subtitle new",
			entryTitle = "Blogs Entry Title new",
			uploadFileName = "Document_1");
	}

	@description = "This test covers LPS-130735. It ensures that the caption of cover image can be viewed in blogs when the small image is removed."
	@priority = "3"
	@refactorneeded
	test CanViewCaptionFieldAfterRemovingSmallImage {
		Blogs.addEntryWithUploadedCoverImage(
			captionField = "true",
			coverImageName = "Document_1",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			navTab = "Blog Images",
			uploadFileName = "Document_1.jpg");

		BlogsEntry.addSmallImage(
			navTab = "Documents and Media",
			uploadFileName = "Document_2.jpg");

		PortletEntry.publish();

		BlogsNavigator.openToEditEntryInSite(
			entryTitle = "Blogs Entry Title",
			groupName = "Guest",
			siteURLKey = "guest");

		BlogsEntry.removeSmallImage(
			images = "true",
			uploadFileName = "Document_2.jpg");

		AssertElementPresent(locator1 = "BlogsEntry#ENTRY_COVER_IMAGE_CAPTION");

		PortletEntry.publish();
	}

	@description = "This checks that the cover image details appear properly"
	@priority = "3"
	@refactordone
	test CanViewCoverImageDetails {
		var imageId	= JSONBlog.uploadBlogImage(
			groupName = "Guest",
			sourceFileName = "Document_1.jpg");

		JSONBlog.addEntryWithImage(
			coverImageId = "${imageId}",
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry Title",
			groupName = "Guest");

		BlogsNavigator.openBlogsAdmin(siteURLKey = "guest");

		BlogsNavigator.gotoEntryCP(entryTitle = "Blogs Entry Title");

		BlogsNavigator.gotoBrowseImage();

		ItemSelector.viewBlogImageDetails(
			imageFileName = "Document_1.jpg",
			imageFormat = "jpg",
			imageSize = "13 KB",
			imageStatus = "approved",
			lastModifiedBy = "Test Test",
			uploadFileName = "Document_1.jpg",
			versionNumber = "1.0");
	}

}