@component-name = "portal-workflow-ee"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property test.run.environment = "EE";
	property testray.main.component.name = "Workflow Metrics";

	setUp {
		TestCase.setUpPortalInstance();

		var testPortalInstance = PropsUtil.get("test.portal.instance");

		User.firstLoginPG();

		Navigator.openURL();

		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Metrics");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
	}

	@description = "LPS-97669 - Verify that the filter options are (All Steps) is the first option in the dropdown and the following fields are sorted alphabetically"
	@ignore = "Test Stub"
	@priority = "3"
	test AllStepsIsTheFirstOptionInDropdown {

		// TODO LRQA-67626 AllStepsIsTheFirstOptionInDropdown pending implementation

	}

	@description = "LPS-98518 - Verify that there is an image besides the assignee name that is retrieved from the global user profile picture (add, delete, update)"
	@priority = "3"
	test AssigneeImagesRetrievedFromGlobalUserProfile {
		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Navigator.gotoNavItem(navItem = "Configuration");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		ApplicationsMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.addCP(
			userEmailAddress = "userfn@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "userfn_");

		Click(locator1 = "Icon#BACK");

		User.assignRegularRoleCP(
			roleTitle = "Power User",
			userScreenName = "userfn_");

		Click(locator1 = "Icon#BACK");

		User.assignRegularRoleCP(
			roleTitle = "Administrator",
			userScreenName = "userfn_");

		Click(locator1 = "Icon#BACK");

		UserNavigator.gotoUser(userScreenName = "userfn_");

		Button.click(button = "Change");

		IFrame.selectModalFrame();

		AssertElementPresent(locator1 = "UsersAndOrganizationsEditUser#UPLOAD_IMAGE_SELECT");

		UploadCommonFile.uploadCommonFileHiddenNoMouseOver(
			locator1 = "TextInput#UPLOAD_FILE",
			value1 = "これは写真です.jpg");

		Pause(locator1 = "3000");

		WaitForElementPresent(locator1 = "UsersAndOrganizationsEditUser#USER_PORTRAIT_CROPPER");

		WaitForElementNotPresent(
			key_text = "Done",
			locator1 = "Button#ANY_DISABLED");

		Button.click(button = "Done");

		Button.clickSave();

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content &amp; Data",
			panel = "Site Administration",
			portlet = "Blogs");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Blogs Entry Subtitle",
			entryTitle = "Blogs Entry");

		UserBar.gotoDropdownItem(dropdownItem = "My Workflow Tasks");

		Navigator.gotoNavTab(navTab = "Assigned to My Roles");

		Workflow.assignByDetails(user = "userfn");

		Navigator.openURL();

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		Click(
			key_assigneeName = "View All Assignees (1)",
			locator1 = "WorkflowMetrics#METRICS_WORKLOAD_BY_ASSIGNEE_NAME_TABLE");

		AssertElementPresent(locator1 = "UserBar#USER_AVATAR_IMAGE_LOADED");
	}

	@description = "LPS-97669 - Verify the user can search for a step with name containing non-ASCII chars (eg: japanese chars) using the search bar"
	@ignore = "Test Stub"
	@priority = "3"
	test CanSearchNonAsciiChars {

		// TODO LRQA-67576 CanSearchNonAsciiChars pending implementation

	}

	@description = "LPS-97669 - Verify that when editing a user name with pending instances, the Workload by Assignee card is updated accordingly"
	@ignore = "Test Stub"
	@priority = "3"
	test CardIsUpdatedWhenUserNameIsEdited {

		// TODO LRQA-67629 CardIsUpdatedWhenUserNameIsEdited pending implementation

	}

	@description = "LPS-97669 - Verify that when deleting a user with pending instances, the Workload by Assignee card is updated accordingly"
	@priority = "4"
	test CardIsUpdatedWhenUserWithPendingInstanceIsDeleted {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		WorkflowMetrics.createUsersAndAssignInstancesWithGroovy(
			numberOfBlogInstances = "1",
			numberOfUsers = "1",
			site = "${siteName}");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		AssertElementPresent(
			key_assigneeName = "1user user1",
			locator1 = "WorkflowMetrics#METRICS_WORKLOAD_BY_ASSIGNEE_CARD_NAME");

		User.openUsersAdmin();

		User.searchCP(searchTerm = "1user user1");

		var key_rowEntry = "1user user1";

		Click(locator1 = "ContentRow#ENTRY_CONTENT_ENTRY_ELLIPSIS");

		MenuItem.clickNoError(menuItem = "Deactivate");

		AssertConfirm(value1 = "Are you sure you want to deactivate this?");

		Alert.viewSuccessMessage();

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		AssertElementNotPresent(
			key_assigneeName = "1user user1",
			locator1 = "WorkflowMetrics#METRICS_WORKLOAD_BY_ASSIGNEE_CARD_NAME");
	}

	@description = "LPS-98518 - Verify that the filters values inside (Workload by Assignee) are alphabetically sorted"
	@ignore = "Test Stub"
	@priority = "2"
	test FiltersAreAlphabeticallySorted {

		// TODO LRQA-67606 FiltersAreAlphabeticallySorted pending implementation

	}

	@description = "LPS-98518 - Verify that the filters inside (Workload by Assignee) are applied only after the user moves the cursor out of the dropdown card"
	@ignore = "Test Stub"
	@priority = "3"
	test FiltersAreAppliedAfterUserMovesCursorOutOfDropdownCard {

		// TODO LRQA-67607 FiltersAreAppliedAfterUserMovesCursorOutOfDropdownCard pending implementation

	}

	@description = "LPS-97669 - Verify that info icon hover state and tooltip message"
	@ignore = "Test Stub"
	@priority = "2"
	test InfoIconDisplaysMessageOnHover {

		// TODO LRQA-67573 InfoIconDisplaysMessageOnHover pending implementation

	}

	@description = "LPS-97669 - Verify that a long username is placed in more than one line, respecting the alignment of the field inside Workload by Assignee card"
	@priority = "3"
	test LongUsernameIsPlacedInMoreThanOneLine {
		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Navigator.gotoNavItem(navItem = "Configuration");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		JSONUser.addUser(
			userEmailAddress = "user1@liferay.com",
			userFirstName = "BuyerBuyerBuyerBuyerBuyerBuyerBuyer",
			userLastName = "BuyerBuyerBuyerBuyerBuyerBuyerBuyer",
			userScreenName = "Buyer");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "user1@liferay.com");

		JSONRole.assignRoleToUser(
			roleTitle = "Administrator",
			userEmailAddress = "user1@liferay.com");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title");

		UserBar.gotoDropdownItem(dropdownItem = "My Workflow Tasks");

		Navigator.gotoNavTab(navTab = "Assigned to My Roles");

		Workflow.assignTaskToUser(
			assetTitle = "Blogs Entry Title",
			assetType = "Blogs Entry",
			assigneeName = "BuyerBuyerBuyerBuyerBuyerBuyerBuyer BuyerBuyerBuyerBuyerBuyerBuyerBuyer",
			workflowTask = "Review");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		AssertCssValue(
			key_assignee = "Buyer",
			locator1 = "WorkflowMetrics#METRICS_PERFORMANCE_BY_ASSIGNEE_NAME",
			locator2 = "line-height",
			value1 = "18px");
	}

	@description = "LPS-98518 - Verify that the (Workload by Assignee) page is providing the loading feedback when the table is being updated"
	@ignore = "Test Stub"
	@priority = "2"
	test PageProvidesLoadingFeedbackWhenTableIsBeingUpdated {

		// TODO LRQA-67611 PageProvidesLoadingFeedbackWhenTableIsBeingUpdated pending implementation

	}

	@description = "LPS-97669 - Verify that there is a percentage indication out of the total amount of assigned tasks when the tab On Time is selected"
	@ignore = "Test Stub"
	@priority = "5"
	test PercentageIndicationOnOnTimeTab {

		// TODO LRQA-67625 PercentageIndicationOnOnTimeTab pending implementation

	}

	@description = "LPS-97669 - Verify that there is a percentage indication out of the total amount of assigned tasks when the tab Overdue is selected"
	@ignore = "Test Stub"
	@priority = "5"
	test PercentageIndicationOnOverdueTab {

		// TODO LRQA-67621 PercentageIndicationOnOverdueTab pending implementation

	}

	@description = "LPS-103365 - Verify that when the filters inside (Workload by Assignee) page are higher than 496px, a search bar on it should be included"
	@ignore = "Test Stub"
	@priority = "3"
	test SearchBarIsIncludedWhenDropdownIsHigherThan496Px {

		// TODO LRQA-67617 SearchBarIsIncludedWhenDropdownIsHigherThan496Px pending implementation

	}

	@description = "LPS-98518 - Verify that a search bar is present in the step filter when the dropdown is higher than 496px"
	@ignore = "Test Stub"
	@priority = "3"
	test SearchBarIsPresentWhenDropdownIsHigherThan496Px {

		// TODO LRQA-67574 SearchBarIsPresentWhenDropdownIsHigherThan496Px pending implementation

	}

	@description = "LPS-103368 - Verify that the user can filter the results inside (Workload by Assignee) page by assignee names that contain non-ascii chars (such as ç,é,コン, etc) using the search field"
	@priority = "3"
	test SearchFieldAcceptsNonAsciiChars {
		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Navigator.gotoNavItem(navItem = "Configuration");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		JSONUser.addUser(
			userEmailAddress = "usertest@liferay.com",
			userFirstName = "Mariã",
			userLastName = "更新",
			userScreenName = "usertest");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "usertest@liferay.com");

		JSONRole.assignRoleToUser(
			roleTitle = "Administrator",
			userEmailAddress = "usertest@liferay.com");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title");

		UserBar.gotoDropdownItem(dropdownItem = "My Workflow Tasks");

		Navigator.gotoNavTab(navTab = "Assigned to My Roles");

		Workflow.assignTaskToUser(
			assetTitle = "Blogs Entry Title",
			assetType = "Blogs Entry",
			assigneeName = "Mariã 更新",
			workflowTask = "Review");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		Click(
			key_assigneesNumber = "1",
			locator1 = "WorkflowMetrics#METRICS_WORKLOAD_BY_ASSIGNEE_CARD_VIEW_ALL_ASSIGNEES_LINK");

		WorkflowMetrics.searchForAssigneeName(assigneeName = "更新");

		AssertElementPresent(
			key_assigneeName = "Mariã 更新",
			locator1 = "WorkflowMetrics#METRICS_WORKLOAD_BY_ASSIGNEE_NAME_TABLE");
	}

	@description = "LPS-98518 - Verify that, in (Workload by Assignee) page, the search field has a hint with the message: (Search for assignee name...)"
	@ignore = "Test Stub"
	@priority = "3"
	test SearchFieldContainsHintMessage {

		// TODO LRQA-67608 SearchFieldContainsHintMessage pending implementation

	}

	@description = "LPS-97669 - Verify that the card (Workload by Assignee) has no more than 10 users"
	@ignore = "Test Stub"
	@priority = "3"
	test SumOfOverdueAndOnTimeAreNeverBiggerThanTotalItems {

		// TODO LRQA-67615 SumOfOverdueAndOnTimeAreNeverBiggerThanTotalItems pending implementation

	}

	@description = "LPS-97669 - Verify there is no percentage indication out of the total amount of assigned tasks when the tab Total is selected"
	@ignore = "Test Stub"
	@priority = "4"
	test ThereIsNoPercentageIndicationOnTotalTab {

		// TODO LRQA-67628 ThereIsNoPercentageIndicationOnTotalTab pending implementation

	}

	@description = "LPS-103365 - Verify that when the user clicks on the username or item number of the table inside (Workload by Assignee) page, the user is directed to the All Items page with the appropriate filters applied"
	@priority = "4"
	test UserIsDirectedToAllItemsPage {
		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Navigator.gotoNavItem(navItem = "Configuration");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry A",
			entryTitle = "Blogs Entry Title A");

		UserBar.gotoDropdownItem(dropdownItem = "My Workflow Tasks");

		Workflow.assignToMeTaskByActions(
			workflowAssetTitle = "Blogs Entry Title A",
			workflowAssetType = "Blogs Entry",
			workflowTask = "Review");

		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Metrics");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		Click(
			key_assigneesNumber = "1",
			locator1 = "WorkflowMetrics#METRICS_PERFORMANCE_BY_ASSIGNEE_CARD_VIEW_ALL_ASSIGNEES_LINK");

		Click(
			key_assignee = "Test Test",
			locator1 = "WorkflowMetrics#METRICS_PERFORMANCE_BY_ASSIGNEE_NAME");

		WorkflowMetrics.verifyFiltersFromDashboard(isFilterOptionPresent = "Test Test,Pending");
	}

	@description = "LPS-97669 - Verify that the card (Workload by Assignee) has no more than 10 users"
	@ignore = "Test Stub"
	@priority = "4"
	test WorkloadByAssigneeCardDisplaysUpTo10Users {

		// TODO LRQA-67616 WorkloadByAssigneeCardDisplaysUpTo10Users pending implementation

	}

}