apply plugin: "org.ysb33r.gradletest"

task copyGradleTestDependencies(type: Copy)
task copyRepo(type: Copy)

String gradleVersion = "5.6.4"

tasks.eclipse {
	ext.gradleVersion = gradleVersion
}

copyGradleTestDependencies {
	from configurations.compile
	into jar.destinationDir
}

copyRepo {
	from "src/gradleTest/repo"
	into new File(buildDir, "gradleTest/repo")
}

dependencies {
	compile group: "biz.aQute.bnd", name: "biz.aQute.bnd", version: "4.3.0"
	compile group: "biz.aQute.bnd", name: "biz.aQute.bnd.gradle", version: "4.3.0"
	compile group: "biz.aQute.bnd", name: "biz.aQute.repository", version: "4.3.0"
	compile group: "biz.aQute.bnd", name: "biz.aQute.resolve", version: "4.3.0"
	compile group: "com.alibaba", name: "fastjson", version: "1.2.62"
	compile group: "com.liferay", name: "com.liferay.gradle.util", version: "1.0.34"
	compile group: "commons-io", name: "commons-io", version: "2.6"
	compile group: "org.dom4j", name: "dom4j", version: "2.1.1"

	compileOnly fileTree(builtBy: [rootProject.tasks.getByName("extractGradleApi" + gradleVersion.replace(".", ""))], dir: new File(rootProject.buildDir, "gradle-${gradleVersion}"), exclude: "lib/plugins/bndlib-*.jar")
}

gradleTest {
	dependsOn copyGradleTestDependencies
	dependsOn copyRepo
	dependsOn jar

	deprecationMessagesAreFailures = false

	versions gradleVersion
}