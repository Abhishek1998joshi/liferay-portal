import com.liferay.gradle.plugins.target.platform.tasks.DependencyManagementTask

apply plugin: "com.liferay.target.platform.ide"
apply plugin: "java"

dependencies {
	targetPlatformBoms group: "com.liferay.portal", name: "release.portal.bom", version: "7.2.1"
	targetPlatformBoms group: "com.liferay.portal", name: "release.portal.bom.compile.only", version: "7.2.1"
	targetPlatformBoms group: "com.liferay.portal", name: "release.portal.bom.third.party", version: "7.2.1"
}

repositories {
	maven {
		url "https://repository-cdn.liferay.com/nexus/content/groups/public"
	}
}

task dependencyManagementJson(type: DependencyManagementTask)
task dependencyManagementText(type: DependencyManagementTask)
task dependencyManagementXml(type: DependencyManagementTask)
task runGradleTest

dependencyManagementJson {
	outputFile = "${buildDir}/test.json"
	outputType = "json"
}

dependencyManagementText {
	outputFile = "${buildDir}/test.txt"
	outputType = "text"
}

dependencyManagementXml {
	outputFile = "${buildDir}/test.xml"
	outputType = "xml"
}

runGradleTest {
	dependsOn dependencyManagementJson, dependencyManagementText, dependencyManagementXml

	doLast {
		File jsonFile = file("${buildDir}/test.json")

		assert jsonFile.text.contains("1.1.4c")

		File txtFile = file("${buildDir}/test.txt")

		assert txtFile.text.contains("xpp3:xpp3_min:1.1.4")

		File xmlFile = file("${buildDir}/test.xml")

		assert xmlFile.text.contains("<artifactId>xml-apis</artifactId>")
	}
}