@component-name = "portal-workflow"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Workflow";

	var workflowAssetType = "Web Content Article";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content & Data",
			panel = "Site Administration",
			portlet = "Web Content");

		Workflow.configureWCWorkflowViaFolderInfo(workflowDefinition = "Single Approver");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			WebContent.tearDownCP();

			Workflow.tearDownPortalWorkflow();

			Workflow.tearDownSiteWorkflow();
		}
	}

	@description = "LPS-135888 - Verify that the user with Account role type receives the notification for review"
	@priority = "4"
	test AccountUserReceivesNotification {
		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");
		
		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Test",
			accountEntryType = "Business");

		Accounts.openAccountsAdmin();

		LexiconEntry.gotoEntry(rowEntry = "Test");

		Accounts.addNewUserToBusinessAccount(
			accountName = "Test",
			assigneeName = "userfn",
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		Accounts.addAssigneeToRoleViaRolesTab(
			accountRoleTitle = "Account Administrator",
			assigneeName = "userfn");

		ApplicationsMenu.gotoPortlet(
			category = "Store Management",
			panel = "Commerce",
			portlet = "Channels");

		CommerceNavigator.gotoEntry(entryName = "Minium Portal");

		Select(
			key_title = "Buyer Order Approval Workflow",
			locator1 = "CommerceEntry#CATALOGS_FORM",
			value1 = "Single Approver (Version 1)");
		
		Button.clickSave();

		ApplicationsMenu.gotoSite(site = "Minium");

		FrontStore.addInitializerProductToCart(
			productName = "U-Joint",
			productQuantity = "1");

		FrontStore.addInitializerProductToCart(
			productName = "Transmission Cooler Line Assembly",
			productQuantity = "1");

		CommerceNavigator.gotoMiniCart();

		Button.click(button = "Review Order");

		Button.click(button = "Submit");

		Workflow.viewWorkflowStatus(status = "Pending");

		AccountUsers.openAccountUsersAdmin();

		AccountUsers.setUserPassword(
			accountUser = "userfn",
			accountUserPassword = "pass");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		UserBar.gotoDropdownItem(dropdownItem = "Notifications");

		Notifications.viewSuccessfulPublication(
			contentBody = "for review in the workflow.",
			portletName = "Test Test",
			publicationType = "sent you a Commerce Order");


	}

	@description = "Verify that the user can open new user details by notifications"
	@ignore = "Test Stub"
	@priority = "3"
	test CanOpenNewUserDetailsByNotifications {

		// TODO LRQA-70881 CanOpenNewUserDetailsByNotifications pending implementation

	}

	@description = "LPS-135888 - Verify that when the user delete the order, the notifications are not displayed"
	@priority = "4"
	test NotificationIsNotAvailableWhenOrderIsDeleted {
		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Test",
			accountEntryType = "Business");

		Accounts.openAccountsAdmin();

		LexiconEntry.gotoEntry(rowEntry = "Test");

		Accounts.addNewUserToBusinessAccount(
			accountName = "Test",
			assigneeName = "userfn",
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		Accounts.addAssigneeToRoleViaRolesTab(
			accountRoleTitle = "Account Administrator",
			assigneeName = "userfn");

		ApplicationsMenu.gotoPortlet(
			category = "Store Management",
			panel = "Commerce",
			portlet = "Channels");

		CommerceNavigator.gotoEntry(entryName = "Minium Portal");

		Select(
			key_title = "Buyer Order Approval Workflow",
			locator1 = "CommerceEntry#CATALOGS_FORM",
			value1 = "Single Approver (Version 1)");

		Button.clickSave();

		ApplicationsMenu.gotoSite(site = "Minium");

		FrontStore.addInitializerProductToCart(
			productName = "U-Joint",
			productQuantity = "1");

		FrontStore.addInitializerProductToCart(
			productName = "Transmission Cooler Line Assembly",
			productQuantity = "1");

		CommerceNavigator.gotoMiniCart();

		Button.click(button = "Review Order");

		Button.click(button = "Submit");

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceJSONOrdersAPI._deleteAllCommerceOrders();

		Navigator.openURL();

		UserBar.gotoDropdownItem(dropdownItem = "Notifications");

		AssertTextEquals(
			locator1 = "Sharing#NOTIFICATIONS_DELETE_ENTRY_TITLE",
			value1 = "Notification no longer applies.");
	}

}