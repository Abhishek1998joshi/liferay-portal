@component-name = "portal-commerce"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property release.feature.flags.disable.DISABLE_PRIVATE_LAYOUTS = "true";
	property testray.main.component.name = "Order Management";

	setUp {
		CommerceConfiguration.commerceSetUp(minium = "true");

		task ("Setup: Create an account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Commerce Account",
				accountEntryType = "Business");
		}
	}

	tearDown {
		CommerceConfiguration.commerceTearDown();
	}

	@description = "Verify a default shipping option can be set, edited, and removed for an account."
	@priority = "3"
	test AddEditAndRemoveNewDefaultShippingOption {
		task ("Given the Sales Manager is on the Order Defaults tab in the Account") {
			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account");
		}

		task ("When the Sales Manager clicks on the Edit button for the Minium channel entry") {
			Click(
				key_entryName = "Minium Portal",
				key_table = "Default Account Commerce Channels Shipping Options",
				locator1 = "CommerceEntry#TABLE_ENTRY_EDIT_BUTTON");

			SelectFrame.selectFrameNoLoading(locator1 = "IFrame#MODAL_BODY");
		}

		task ("Then the Sales Manager can choose between all eligible shipping options and save") {
			AssertElementPresent(
				key_radioOption = "Use Priority Settings",
				locator1 = "CommerceEntry#RADIO_BUTTON");

			AssertElementPresent(
				key_radioOption = "Flat Rate / Standard Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");

			Click.clickAtNotVisible(
				key_radioOption = "Flat Rate / Expedited Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");

			Button.clickSave();

			IFrame.selectTopFrame();

			AssertElementPresent(
				key_columnNumber = "1",
				key_productName = "Minium Portal",
				key_value = "Flat Rate",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");

			AssertElementPresent(
				key_columnNumber = "2",
				key_productName = "Minium Portal",
				key_value = "Expedited Delivery",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");
		}

		task ("When the Sales Manager clicks on the Edit button for the Minium channel entry and selects a different shipping option") {
			Click(
				key_entryName = "Minium Portal",
				key_table = "Default Account Commerce Channels Shipping Options",
				locator1 = "CommerceEntry#TABLE_ENTRY_EDIT_BUTTON");

			SelectFrame.selectFrameNoLoading(locator1 = "IFrame#MODAL_BODY");

			Click.clickAtNotVisible(
				key_radioOption = "Flat Rate / Standard Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");

			Button.clickSave();

			IFrame.selectTopFrame();
		}

		task ("Then the default account shipping option is updated") {
			AssertElementPresent(
				key_columnNumber = "1",
				key_productName = "Minium Portal",
				key_value = "Flat Rate",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");

			AssertElementPresent(
				key_columnNumber = "2",
				key_productName = "Minium Portal",
				key_value = "Standard Delivery",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");
		}

		task ("When the Sales Manager clicks on the Edit button for the Minium channel entry and selects Use Priority Settings") {
			Click(
				key_entryName = "Minium Portal",
				key_table = "Default Account Commerce Channels Shipping Options",
				locator1 = "CommerceEntry#TABLE_ENTRY_EDIT_BUTTON");

			SelectFrame.selectFrameNoLoading(locator1 = "IFrame#MODAL_BODY");

			Click.clickAtNotVisible(
				key_radioOption = "Use Priority Settings",
				locator1 = "CommerceEntry#RADIO_BUTTON");

			Button.clickSave();

			IFrame.selectTopFrame();
		}

		task ("Then the default account shipping option is updated to Use Priority Settings") {
			AssertElementPresent(
				key_columnNumber = "1",
				key_productName = "Minium Portal",
				key_value = "Use Priority Settings",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");

			AssertElementPresent(
				key_columnNumber = "2",
				key_productName = "Minium Portal",
				key_value = "Use Priority Settings",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");
		}

		task ("And the Active column becomes empty") {
			AssertTextEquals(
				key_columnNumber = "3",
				key_productName = "Minium Portal",
				key_value = "",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT",
				value1 = "");
		}
	}

	@description = "Verify only one default account shipping option can be set."
	@priority = "3"
	test DefaultShippingOptionsAreSingleSelectable {
		task ("Given the Sales Manager is on the Order Defaults tab in the Account") {
			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account");
		}

		task ("When the Sales Manager clicks on the Edit button for the Minium channel entry") {
			Click(
				key_entryName = "Minium Portal",
				key_table = "Default Account Commerce Channels Shipping Options",
				locator1 = "CommerceEntry#TABLE_ENTRY_EDIT_BUTTON");

			SelectFrame.selectFrameNoLoading(locator1 = "IFrame#MODAL_BODY");
		}

		task ("And clicks on Flat Rate/Standard Delivery") {
			Click.clickAtNotVisible(
				key_radioOption = "Flat Rate / Standard Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");
		}

		task ("And clicks on Flat Rate/Expedited Delivery") {
			Click.clickAtNotVisible(
				key_radioOption = "Flat Rate / Expedited Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");
		}

		task ("Then the first selected shipping option is unselected because only one default shipping option can be set") {
			AssertNotChecked.assertNotCheckedNotVisible(
				key_radioOption = "Flat Rate / Standard Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");
		}

		task ("And the second shipping option remains selected") {
			AssertChecked.assertCheckedNotVisible(
				key_radioOption = "Flat Rate / Expedited Delivery",
				locator1 = "CommerceEntry#RADIO_BUTTON");
		}
	}

	@description = "Verify the list of selectable default shipping options is sorted alphanumerically by name and that Use Priority Settings is an option."
	@priority = "3"
	test VerifyIfDefaultShippingOptionsAreSortedAndIfUsePrioritySettingArePresentIntoTheList {
		task ("Given the Sales Manager is on the Order Defaults tab in the Account") {
			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account");
		}

		task ("And given Use Priority Settings is pre-selected for Default Account Commerce Channels Shipping Options") {
			AssertElementPresent(
				key_columnNumber = "1",
				key_productName = "Minium Portal",
				key_value = "Use Priority Settings",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");

			AssertElementPresent(
				key_columnNumber = "2",
				key_productName = "Minium Portal",
				key_value = "Use Priority Settings",
				locator1 = "CommerceEntry#TABLE_SEARCH_BY_NAME_AND_COLUMN_CONTENT");
		}

		task ("When the Sales Manager clicks on the Edit button for the Minium Channel entry") {
			Click(
				key_entryName = "Minium Portal",
				key_table = "Default Account Commerce Channels Shipping Options",
				locator1 = "CommerceEntry#TABLE_ENTRY_EDIT_BUTTON");

			SelectFrame.selectFrameNoLoading(locator1 = "IFrame#MODAL_BODY");
		}

		task ("Then an alphanumerically sorted list with all eligible shipping options linked to the Minium channel appears") {
			AssertElementPresent(
				key_radioOption = "Use Priority Settings",
				locator1 = "CommerceEntry#RADIO_BUTTON");

			AssertTextEquals(
				key_rowNumber = "2",
				locator1 = "Radio#LABEL_NUMBER",
				value1 = "Flat Rate / Expedited Delivery");

			AssertElementPresent(
				key_rowNumber = "3",
				locator1 = "Radio#LABEL_NUMBER",
				value1 = "Flat Rate / Standard Delivery");
		}
	}

}